# Websocket

WebSocket ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª —Å–≤—è–∑–∏ –ø–æ–≤–µ—Ä—Ö TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

–í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –≤ W3C –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è API Web Sockets. –ß–µ—Ä–Ω–æ–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ —ç—Ç–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —É—Ç–≤–µ—Ä–∂–¥—ë–Ω IETF.

WebSocket —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –≤–æ–ø–ª–æ—â–µ–Ω–∏—è –≤ –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–∞—Ö –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞—Ö, –Ω–æ –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –ª—é–±–æ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ—Ç–æ–∫–æ–ª WebSocket ‚Äî —ç—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–µ TCP. –û–Ω –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º –±–æ–ª–µ–µ —Ç–µ—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º –∏ –≤–µ–±-—Å–∞–π—Ç–æ–º, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏ —Å–æ–∑–¥–∞–Ω–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

![ws-place-in-stack](images/ws-place-in-stack.jpg)

## –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–∞ WebSocket (–ø—Ä–æ—Ç–æ–∫–æ–ª 07)

![ws-headers-format](images/ws-headers-format.jpg)

### Request
```HTTP
GET /chat HTTP/1.1
Host: server.example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Origin: http://example.com
Sec-WebSocket-Protocol: chat, superchat
Sec-WebSocket-Version: 7
```

### Response
```HTTP
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
Sec-WebSocket-Protocol: chat
```

![ws-data-transfer](images/ws-data-transfer.jpg)

## Ping Pong
![ws-ping-pong](images/ws-ping-pong.jpg)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–∞—Ö

https://caniuse.com/websockets

![browser-support](images/browser-support.png)

## –®–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ wss

## –°–ø–æ—Å–æ–±—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è websocket
–ü—Ä–æ—Ç–æ–∫–æ–ª WebSocket –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é. –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ WebSocket, –æ—Ç–∫—Ä—ã—Ç—ã–π —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç ¬´–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏¬ª –∫–∞–∫—É—é-–ª–∏–±–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é; –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—å —à–∞–≥–∏, —á—Ç–æ–±—ã —Ç–∞–∫–∂–µ –∑–∞—â–∏—Ç–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ WebSocket.

–≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏, –ø–æ—Å–∫–æ–ª—å–∫—É WebSockets –±—É–¥—É—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ HTTP, –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–ª—è —Å–≤–æ–∏—Ö –≤–µ–±-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö WebSocket.

–ü–æ—Å–∫–æ–ª—å–∫—É –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ WebSocket –∏–∑ JavaScript, –≤—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã ¬´–Ω–µ—è–≤–Ω–æ–π¬ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π (—Ç. –µ. –±–∞–∑–æ–≤–æ–π –∏–ª–∏ –∫—É–∫–∏-—Ñ–∞–π–ª–∞–º–∏), –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –æ–±—ã—á–Ω–æ —Å–µ—Ä–≤–µ—Ä, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–π WebSockets, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–¥–µ–ª–µ–Ω –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–µ–≥–æ ¬´–æ–±—ã—á–Ω—ã–µ¬ª HTTP-–∑–∞–ø—Ä–æ—Å—ã. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞—Ç—Ä—É–¥–Ω–∏—Ç—å –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

–ò—Ç–∞–∫, –æ–¥–∏–Ω —à–∞–±–ª–æ–Ω, –∫–∞–∂–µ—Ç—Å—è, —Ö–æ—Ä–æ—à–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ WebSocket, ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ ¬´—Ç–∏–∫–µ—Ç–æ–≤¬ª. –í –æ–±—â–∏—Ö —á–µ—Ä—Ç–∞—Ö —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:

- –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ —Ä–µ—à–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å WebSocket, –æ–Ω —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å HTTP-—Å–µ—Ä–≤–µ—Ä–æ–º, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ¬´—Ç–∏–∫–µ—Ç¬ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
- –°–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç —Ç–∏–∫–µ—Ç. –û–±—ã—á–Ω–æ –æ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∫–æ–π-—Ç–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏, IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞, –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ —Ç–∏–∫–µ—Ç, –æ—Ç–º–µ—Ç–∫—É –≤—Ä–µ–º–µ–Ω–∏ –∏ –ª—é–±—ã–µ –¥—Ä—É–≥–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è.
- –°–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç —ç—Ç–æ—Ç —Ç–∏–∫–µ—Ç (—Ç.–µ. –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∫—ç—à–µ), –∞ —Ç–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –∫–ª–∏–µ–Ω—Ç—É.
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ WebSocket –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç ¬´—Ç–∏–∫–µ—Ç¬ª –∫–∞–∫ —á–∞—Å—Ç—å –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è.
- –ó–∞—Ç–µ–º —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å —ç—Ç–æ—Ç —Ç–∏–∫–µ—Ç, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞, —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–∏–∫–µ—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏ —Å—Ä–æ–∫ –µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –∏—Å—Ç–µ–∫, –∞ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±—É—é –¥—Ä—É–≥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π. –ï—Å–ª–∏ –≤—Å–µ –ø–æ–π–¥–µ—Ç —Ö–æ—Ä–æ—à–æ, —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ WebSocket –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ.

![ticket](images/ticket.jpeg)

## üîé –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Ç–∏–∫–µ—Ç–∞—Ö
```
cd fastapi-websocket-tickets-auth/src && python main.py
```

## Websocket broadcasting –Ω–∞ –æ—Å–Ω–æ–≤–µ Redis
- channels
- broadcaster
- manual

## üîé –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –≤–µ—â–∞–Ω–∏—è (broadcasting)
```
cd fastapi-websocket-broadcast && uvicorn app:app
```

## –ü—Ä–æ–±–ª–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è WebSocket

## –ú–∞—Ç–µ—Ä–∏–∞–ª—ã
- https://devcenter.heroku.com/articles/websocket-security#:~:text=The%20WebSocket%20protocol%20doesn't,also%20secure%20the%20WebSocket%20connection.
- https://lucumr.pocoo.org/2012/9/24/websockets-101/
- https://dev.to/sangarshanan/realtime-channels-with-fastapi-broadcaster-47jh
- https://fastapi.tiangolo.com/advanced/websockets/
- https://github.com/kthwaite/fastapi-websocket-broadcast
- https://github.com/django/channels_redis
- https://channels.readthedocs.io/en/stable/topics/channel_layers.html
- https://youtu.be/8ARodQ4Wlf4